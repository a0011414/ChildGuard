# 実装前に確認・決めておくこと

最小限の機能を持ったアプリの実装に進む前に、考えが甘い／曖昧になりがちな点のチェックリスト。  
決まったらメモを追記し、未決のまま実装に入ると後から設計がぶれやすい。

**全7項目の方針決定済み（2026-02-26）。実装に進める状態。**

---

## 1. iOS で「制御」をどう実現するか（未調査のまま実装リスク大）

- **現状**: 「Family Controls / ManagedSettings / DeviceActivity 等が前提になりそう」と TODO にあるが、**技術メモに調査結果がまだない**。
- **リスク**: 実装に入ってから「この API は○○の制約で使えない」「保護者用・子用のペアが必須」などと判明すると、手戻りが大きい。
- **やること**: Apple の Family Controls / DeviceActivity のドキュメントとサンプルを確認し、**使える範囲・制約・必要なアプリ構成**（保護者用アプリと管理対象デバイスの関係）を技術メモに書く。
- **メモ欄**: ✅ 技術メモに追記済み（2026-02-26）。Family Controls 事前申請必須、制限は子の端末で動作するため子の iPhone にもアプリが必要、DeviceActivity/ManagedSettings の制約あり。

---

## 2. プロトタイプの「最小単位」を具体化する

- **現状**: 「1ルール＋1制御」とあるが、**どの1ルールか**（例：1日〇時間まで）が決まっていない。
- **リスク**: 範囲がブレて、何を実装すれば「最小限」なのか曖昧になる。
- **やること**: 要件メモのルール例のうち、**最初に実装するルールを1つに絞って書く**。例：「1日2時間まで」に達したら通知し、それ以降はアプリ利用を制限する、など。
- **メモ欄**: ✅ **C**「〇時間超えそうなので止めた」と親に通知し、自動で使用制限（通知＋制限の連動）。プロトタイプの最小単位の1ルールとして決定。

---

## 3. アプリの構成（親用・子用・1本化）

- **現状**: 「親の iPhone で編集」「子の iPhone で読んで適用」とあるが、**1つのアプリで親・子の両方の役割を果たすか、親用アプリと子用アプリを分けるか**が明文化されていない。
- **背景**: Apple の Family Controls では、多くの場合「保護者用アプリ」が設定を行い、管理対象の子のデバイスには別の設定やコンテンツが求められる。1アプリでロール切り替えするか、2アプリにするかで実装が変わる。
- **やること**: 最小プロトタイプでは「親用 UI」と「子用 UI」をどう持つか（1アプリ内の画面切り替えか、別ターゲットか）を決める。
- **メモ欄**: ✅ **1本のアプリ**で、親子でモード切り替え。親も子も同じアプリを入れ、親モード／子モードで切り替える。開発・TestFlight・申請が1本で済む。

---

## 4. MCP（エージェント）を最小プロトで使うか

- **現状**: 要件では「MCP がルールを参照し制限・通知・制御を行う」とあるが、**最小プロトタイプで MCP を本当に使うか**が未定。ルールを解釈するのが「Swift の単純なロジック」で足りるなら、MCP は後回しにできる。
- **リスク**: 最初から MCP を使うと決めると、載せ先（端末内／サーバ）を決めないと実装に入れない。未決定のまま進むと後から設計が大きく変わる可能性がある。
- **やること**: 「まずは MCP なしで、ルール（iCloud）を読んで iOS API に渡すだけにする」か「最初から MCP を組み込むか」を方針として決める。
- **メモ欄**: ✅ **最小プロトでは MCP なし**。Swift でルールを読み、iOS の Family Controls / DeviceActivity に渡す。MCP は後から組み込むことも可能。

---

## 5. Apple Developer Program

- **現状**: TestFlight や Ad Hoc で自分・子の iPhone に配るには、有料の Apple Developer Program が必要。
- **リスク**: 実装は進んでも、実機で子の端末まで含めて検証するタイミングで加入が必要になり、そこで止まる。
- **やること**: 実装開始時点で**加入済みか、同時に申し込むか**を決める。自宅用だけなら Xcode から USB で直接インストール（有効期限あり）でも試せるが、継続して配るなら早めの加入がおすすめ。
- **メモ欄**: ✅ シミュレータで（このPCで）両方のアプリが期待どおり動くのを確認してから、1アカウント（Developer Program）を取る方針。よくある進め方で問題ない。

---

## 6. 親→子の共有（CKShare）のオンボーディング

- **現状**: ルールは CKShare で親から子に共有する想定。子が「共有招待を承諾する」必要がある。
- **リスク**: このフローをアプリ内でどう案内するかが未設計だと、初回セットアップで離脱したり、使い方が伝わらなかったりする。
- **やること**: 最小プロトでも「子が共有を承諾する」画面や説明をどう入れるか、簡単でよいのでメモしておく。
- **メモ欄**: ✅ **よくあるペアレンタルコントロールの方法**でよい。親が「子どもを追加」して共有を送る → 子の端末に招待が届く → 子が承諾する流れ。子モード初回または設定に「親から共有が届いたら承諾してください」の案内を入れる。

---

## 7. 免責・利用規約

- **現状**: 自宅用・無料でも、利用規約や免責の文言をどこか（README、アプリ内）に用意しておくことが推奨されている（引き継ぎ・市場メモの文脈）。
- **やること**: 最小限の実装に**含めるか・後回しにするか**を方針として決める。含めるなら、文言のたたき台をどこに置くかも決める。
- **メモ欄**: ✅ **含める**。アプリ内の「設定」や「このアプリについて」に短い免責＋利用上の注意を入れる。文言のたたき台は実装の段階で用意する。

---

## まとめ：実装前に特に決めたいこと

| 優先度 | 項目 | 理由 |
|--------|------|------|
| 高 | 1. iOS の「制御」API の調査 | ここが未確認のまま進むと手戻りが最大 |
| 高 | 2. 最小単位の1ルールを決める | 実装範囲がブレないようにする |
| 高 | 3. アプリ構成（親用・子用・1本化） | 最初の一歩の実装方針が変わる |
| 中 | 4. MCP を最小プロトで使うか | 設計の複雑さと載せ先に直結 |
| 中 | 5. Developer Program の有無・時期 | 実機検証・配布のタイミングに影響 |
| 低 | 6. CKShare のオンボーディング | 初回セットアップの UX |
| 低 | 7. 免責・利用規約 | 後追いでもよいが方針は決めておく |

---

## 参照

- 技術的な詳細: 技術メモ.md
- 要件・ルール例: 要件メモ.md
- 次に考えること: TODO.md
